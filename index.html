<!DOCTYPE html>
<html>
<head>
<title>Notes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=">
<style>
body{
margin:0;
font-family:sans-serif;
transition:.3s;
background:#f5f5f5;
color:#000
}
.dark-mode{
background:#222;
color:#fff
}
header{
padding:15px;
text-align:center;
font-size:22px
}
.notes-grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
gap:15px;
padding:15px;
max-width:900px;
margin:auto
}
.note{
background:#fff;
padding:15px;
border-radius:8px;
cursor:pointer;
min-height:100px;
word-wrap:break-word
}
.dark-mode .note{
background:#333
}
.add-btn{
position:fixed;
bottom:80px;
right:20px;
width:60px;
height:60px;
border-radius:50%;
font-size:32px;
border:none;
background:#eee;
cursor:pointer
}
.dark-mode .add-btn{
background:#444;
color:#fff
}
.editor{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:#fff;
display:none;
flex-direction:column
}
.dark-mode .editor{
background:#222
}
textarea{
flex:1;
border:none;
padding:15px;
font-size:16px;
resize:none;
outline:none;
background:transparent;
color:inherit
}
.editor button{
padding:15px;
border:none;
background:#eee;
cursor:pointer
}
.dark-mode .editor button{
background:#444;
color:#fff
}
footer{
position:fixed;
bottom:0;
width:100%;
text-align:center;
padding:15px;
background:#fff;
transition:.3s
}
.dark-mode footer{
background:#222
}
.footer-links{
display:flex;
justify-content:center;
gap:10px
}
.footer-links button{
border:1px solid #ccc;
background:#eee;
padding:5px 10px;
border-radius:4px;
cursor:pointer;
font-size:12px
}
.dark-mode .footer-links button{
background:#444;
color:#fff;
border-color:#555
}
#mobileThemeBtn{
display:none
}
@media(max-width:600px){
#mobileThemeBtn{display:inline-block}
}
</style>
</head>
<body>

<header>Notes</header>

<div id="login" style="text-align:center;padding-top:50px">
<button id="googleBtn">Sign in with Google</button>
</div>

<div id="app" style="display:none">
<div class="notes-grid" id="notes"></div>
<button class="add-btn" id="addBtn">+</button>
</div>

<div class="editor" id="editor">
<textarea id="editorText"></textarea>
<button id="saveBtn">Save</button>
</div>

<footer>
<div class="footer-links">
<button id="logoutBtn">Logout</button>
<button id="mobileThemeBtn">ðŸŒ“</button>
</div>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js"
import { getAuth, GoogleAuthProvider, signInWithRedirect, signOut, onAuthStateChanged, getRedirectResult } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js"
import { getFirestore, collection, addDoc, query, where, orderBy, onSnapshot, updateDoc, doc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js"

const firebaseConfig={
apiKey:"AIzaSyAJYwEuF27rNMANqpE49PnLoRJPJlzFGBc",
authDomain:"notes-matteus--firebase.firebaseapp.com",
projectId:"notes-matteus--firebase",
storageBucket:"notes-matteus--firebase.firebasestorage.app",
messagingSenderId:"601405793462",
appId:"1:601405793462:web:39d554bd7e7fb0e41df217"
}

const app=initializeApp(firebaseConfig)
const auth=getAuth(app)
const db=getFirestore(app)
const provider=new GoogleAuthProvider()

const loginDiv=document.getElementById("login")
const appDiv=document.getElementById("app")
const notesDiv=document.getElementById("notes")
const editor=document.getElementById("editor")
const editorText=document.getElementById("editorText")

let currentNote=null

document.getElementById("googleBtn").onclick=()=>signInWithRedirect(auth,provider)
document.getElementById("logoutBtn").onclick=()=>signOut(auth)
document.getElementById("addBtn").onclick=()=>{
currentNote=null
editorText.value=""
editor.style.display="flex"
}
document.getElementById("saveBtn").onclick=saveNote

getRedirectResult(auth)

onAuthStateChanged(auth,u=>{
if(u){
loginDiv.style.display="none"
appDiv.style.display="block"
loadNotes(u.uid)
}else{
loginDiv.style.display="block"
appDiv.style.display="none"
}
})

function loadNotes(uid){
const q=query(
collection(db,"notes"),
where("uid","==",uid),
orderBy("time","desc")
)
onSnapshot(q,s=>{
notesDiv.innerHTML=""
s.forEach(d=>{
const n=document.createElement("div")
n.className="note"
n.innerText=d.data().text
n.onclick=()=>{
currentNote=d.id
editorText.value=d.data().text
editor.style.display="flex"
}
notesDiv.appendChild(n)
})
})
}

async function saveNote(){
if(editorText.value===""){editor.style.display="none";return}
if(currentNote){
await updateDoc(doc(db,"notes",currentNote),{
text:editorText.value,
time:Date.now()
})
}else{
await addDoc(collection(db,"notes"),{
uid:auth.currentUser.uid,
text:editorText.value,
time:Date.now()
})
}
editor.style.display="none"
}

if(localStorage.getItem("darkMode")==="enabled"){
document.body.classList.add("dark-mode")
}

document.addEventListener("keydown",e=>{
if(e.key==="m"||e.key==="M")toggleTheme()
})

document.getElementById("mobileThemeBtn").onclick=toggleTheme

function toggleTheme(){
document.body.classList.toggle("dark-mode")
localStorage.setItem("darkMode",document.body.classList.contains("dark-mode")?"enabled":"disabled")
}
</script>
</body>
</html>
