<!DOCTYPE html>
<html>
<head>
<title>Notes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=">
<style>
body{
font-family:sans-serif;
display:flex;
justify-content:center;
padding-top:50px;
transition:background-color .3s,color .3s
}
.dark-mode{
background:#222;
color:white
}
.dark-mode textarea{
background:#333;
color:white;
border:1px solid #555
}
.dark-mode button{
background:#444;
color:white;
border:1px solid #555
}
.container{
width:300px
}
textarea{
width:100%;
height:120px;
padding:10px;
border-radius:5px;
border:1px solid #ccc;
resize:none
}
button{
padding:10px;
border-radius:5px;
border:1px solid #ccc;
background:#eee;
cursor:pointer;
margin-top:5px;
width:100%
}
.note{
background:#f4f4f4;
padding:10px;
border-radius:5px;
margin-top:10px;
cursor:pointer;
word-wrap:break-word
}
.dark-mode .note{
background:#333
}
#mobileThemeBtn{
display:none;
margin-top:5px
}
@media(max-width:600px){
#mobileThemeBtn{display:block}
}
</style>
</head>
<body>
<div class="container">
<div id="login">
<button id="googleBtn">Sign in with Google</button>
</div>
<div id="app" style="display:none">
<textarea id="noteInput" placeholder="New note..."></textarea>
<button id="saveBtn">Save</button>
<button id="mobileThemeBtn">ðŸŒ“</button>
<div id="notes"></div>
<button id="logoutBtn" style="margin-top:20px">Logout</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js"
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js"
import { getFirestore, collection, addDoc, query, where, orderBy, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js"

const firebaseConfig={
apiKey:"AIzaSyAJYwEuF27rNMANqpE49PnLoRJPJlzFGBc",
authDomain:"notes-matteus--firebase.firebaseapp.com",
projectId:"notes-matteus--firebase",
storageBucket:"notes-matteus--firebase.firebasestorage.app",
messagingSenderId:"601405793462",
appId:"1:601405793462:web:39d554bd7e7fb0e41df217"
}

const app=initializeApp(firebaseConfig)
const auth=getAuth(app)
const db=getFirestore(app)
const provider=new GoogleAuthProvider()

const loginDiv=document.getElementById("login")
const appDiv=document.getElementById("app")
const notesDiv=document.getElementById("notes")
const noteInput=document.getElementById("noteInput")

document.getElementById("googleBtn").onclick=()=>signInWithPopup(auth,provider)
document.getElementById("logoutBtn").onclick=()=>signOut(auth)
document.getElementById("saveBtn").onclick=addNote

onAuthStateChanged(auth,u=>{
if(u){
loginDiv.style.display="none"
appDiv.style.display="block"
loadNotes(u.uid)
}else{
loginDiv.style.display="block"
appDiv.style.display="none"
}
})

async function addNote(){
if(noteInput.value==="")return
await addDoc(collection(db,"notes"),{
uid:auth.currentUser.uid,
text:noteInput.value,
time:Date.now()
})
noteInput.value=""
}

function loadNotes(uid){
const q=query(
collection(db,"notes"),
where("uid","==",uid),
orderBy("time","desc")
)
onSnapshot(q,s=>{
notesDiv.innerHTML=""
s.forEach(d=>{
const n=document.createElement("div")
n.className="note"
n.innerText=d.data().text
n.onclick=()=>deleteDoc(doc(db,"notes",d.id))
notesDiv.appendChild(n)
})
})
}

if(localStorage.getItem("darkMode")==="enabled"){
document.body.classList.add("dark-mode")
}

document.addEventListener("keydown",e=>{
if(e.key==="m"||e.key==="M")toggleTheme()
})

document.getElementById("mobileThemeBtn").onclick=toggleTheme

function toggleTheme(){
document.body.classList.toggle("dark-mode")
localStorage.setItem(
"darkMode",
document.body.classList.contains("dark-mode")?"enabled":"disabled"
)
}
</script>
</body>
</html>
